import os
import boto3
import time

#######set environment varibles in Lambda###############

ami = os.environ['ami']
instance_type = os.environ['instance_type']
key_name = os.environ['key_name']
subnet_id = os.environ['subnet_id']

ec2 = boto3.resource('ec2')
client = boto3.client('ec2')
sns = boto3.client('sns')


deflambda_handler(event,context):

  Inst_id=create_ec2()
  send_msg(Inst_id)

def create_ec2():
    instance = ec2.create_instances(
      ImageId =ami,
      InstanceType= instance_type,
      KeyName= key_name,
      SubnetId= subnet_id,
      MaxCount=1,
      MinCount=1
       )


    print("instance id is" , instance[0].id)

    Inst_id = instance[0].id
    return Inst_id
    time.sleep(15)

defsend_msg(Inst_id):  

    msg="Hello from lambda.Your newly launched Instance Id is:" + " "+ Inst_id

    response = sns.publish(
        TopicArn="arn:aws:sns:ap-south-1:240631325177:EC2Topic",
        Message= msg
    )
   





